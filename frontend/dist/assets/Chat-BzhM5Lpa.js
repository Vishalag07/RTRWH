var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,i=(t,r,s)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s,l=(e,t)=>{for(var r in t||(t={}))a.call(t,r)&&i(e,r,t[r]);if(s)for(var r of s(t))n.call(t,r)&&i(e,r,t[r]);return e},o=(e,s)=>t(e,r(s));import{u as c,k as d,r as m,j as u,L as h}from"./react-vendor-CJ3VGwWI.js";import{u as f,a as x}from"./index-ZW20BDBo.js";import"./vendor-wFsWlTaG.js";import"./framer-motion-C2hfdD_N.js";function p(){const{t:e}=c(),t=d(),{isAuthenticated:r,isLoading:s}=f(),{isDark:a}=x(),[n,i]=m.useState([]),[p,b]=m.useState(""),[g,v]=m.useState(!1),[y,j]=m.useState(!1),w=m.useRef(null),N=m.useRef(!0),S=m.useRef({}),_=m.useRef(null),k=m.useRef(!1),O=m.useRef(!1);if(m.useEffect(()=>{if(N.current)N.current=!1;else if(k.current)k.current=!1;else if(!O.current&&!g&&_.current){const e=_.current,t=S.current[e];return t&&t.scrollIntoView({behavior:"smooth",block:"center"}),void(_.current=null)}},[n,g]),m.useEffect(()=>{},[g]),m.useEffect(()=>{window.scrollTo({top:0,left:0,behavior:"auto"})},[]),m.useEffect(()=>{s||r||t("/auth?mode=login")},[r,s,t]),m.useEffect(()=>{const e=sessionStorage.getItem("predefinedMessage");e&&(sessionStorage.removeItem("predefinedMessage"),setTimeout(()=>{O.current=!0,D(e),window.scrollTo({top:0,left:0,behavior:"smooth"})},100))},[]),s)return u.jsx("div",{className:"min-h-screen flex items-center justify-center "+(a?"bg-slate-900":"bg-gradient-to-br from-slate-50 via-blue-50 to-cyan-50"),children:u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),u.jsx("p",{className:"text-lg font-medium "+(a?"text-slate-300":"text-slate-600"),children:"Checking authentication..."})]})});if(!r)return null;const D=(t,r)=>{return s=this,a=null,n=function*(){var r;const s=(t||p).trim();if(!s||y)return;const a={id:Date.now().toString(),content:s,isUser:!0,timestamp:new Date};i(e=>[...e,a]),b(""),j(!0);const n=(Date.now()+1).toString();i(e=>[...e,{id:n,content:"",isUser:!1,timestamp:new Date,isStreaming:!0}]);try{const t="http://localhost:8000/api";if(!t.includes("localhost:8000")||"localhost"!==window.location.hostname)return void setTimeout(()=>{i(e=>e.map(e=>e.id===n?o(l({},e),{content:"I'm a demo AI assistant. The backend is not currently available, but I can help you with general questions about rainwater harvesting and water conservation.",isStreaming:!1}):e)),j(!1)},1e3);const s=yield fetch(`${t}/chat/stream`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:a.content})});if(!s.ok)throw new Error(e("chat.error_response"));const d=null==(r=s.body)?void 0:r.getReader(),m=new TextDecoder;if(d){let e="";for(;;){const{done:t,value:r}=yield d.read();if(t)break;O.current=!0;const s=m.decode(r).split("\n");for(const a of s)if(a.startsWith("data: "))try{const t=JSON.parse(a.slice(6));t.chunk&&"[DONE]"!==t.chunk&&(e+=t.chunk,i(t=>t.map(t=>t.id===n?o(l({},t),{content:e}):t)))}catch(c){}}}i(e=>e.map(e=>e.id===n?o(l({},e),{isStreaming:!1}):e)),O.current=!1}catch(d){i(t=>t.map(t=>t.id===n?o(l({},t),{content:e("chat.error_message"),isStreaming:!1}):t))}finally{j(!1)}},new Promise((e,t)=>{var r=e=>{try{l(n.next(e))}catch(r){t(r)}},i=e=>{try{l(n.throw(e))}catch(r){t(r)}},l=t=>t.done?e(t.value):Promise.resolve(t.value).then(r,i);l((n=n.apply(s,a)).next())});var s,a,n},E=()=>i([]);return e("voice_commands.send_message"),e("voice_commands.clear_chat"),e("voice_commands.go_home"),u.jsxs("div",{className:`min-h-screen pt-24 pb-10 ${a?"bg-slate-900":"bg-gray-50"} flex flex-col items-center px-4`,children:[u.jsxs("header",{className:"w-full max-w-4xl flex justify-between items-center mb-4",children:[u.jsx(h,{to:"/",className:"text-blue-600 hover:underline",children:e("chat.back_to_home")}),u.jsx("div",{className:"flex items-center gap-3",children:u.jsx("button",{onClick:E,className:"px-3 py-2 text-sm text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg hover:bg-gray-100","aria-label":e("aria.clear_chat"),children:e("chat.clear_chat")})})]}),u.jsx("main",{className:"w-full max-w-4xl",role:"main",children:u.jsxs("div",{className:"relative rounded-2xl border border-gray-200 bg-white shadow-lg overflow-hidden",children:[u.jsxs("div",{className:"h-96 overflow-y-auto p-6 space-y-4","aria-live":"polite",children:[0===n.length?u.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"text-4xl mb-4",children:"ðŸ¤–"}),u.jsx("p",{className:"text-lg",children:e("chat.welcome_title")}),u.jsx("p",{className:"text-sm mt-2",children:e("chat.welcome_subtitle")})]})}):n.map(e=>u.jsx("div",{ref:t=>{S.current[e.id]=t},className:"flex "+(e.isUser?"justify-end":"justify-start"),children:u.jsxs("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-2xl "+(e.isUser?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"),children:[u.jsxs("p",{className:"text-sm",children:[e.content,e.isStreaming&&u.jsx("span",{className:"inline-block w-2 h-4 bg-current animate-pulse ml-1"})]}),u.jsx("time",{className:"text-xs mt-1 "+(e.isUser?"text-blue-100":"text-gray-500"),children:e.timestamp.toLocaleTimeString()})]})},e.id)),u.jsx("div",{ref:w})]}),u.jsx("div",{className:"border-t border-gray-200 p-4",children:u.jsxs("div",{className:"flex gap-3",children:[u.jsx("input",{type:"text",value:p,onChange:e=>{b(e.target.value),v(!0)},onBlur:()=>v(!1),onKeyPress:e=>"Enter"===e.key&&!e.shiftKey&&(e.preventDefault(),v(!1),D()),placeholder:e("chat.input_placeholder"),disabled:y,className:"flex-1 rounded-lg border-gray-300 px-4 py-2 focus:ring-2 focus:ring-blue-500","aria-label":e("aria.chat_input")}),u.jsx("button",{onClick:()=>D(),disabled:!p.trim()||y,className:"px-6 py-2 rounded-lg text-white font-semibold shadow "+(!p.trim()||y?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"),"aria-label":e("aria.send_message"),children:e(y?"chat.sending":"chat.send")})]})})]})})]})}export{p as Chat,p as default};
