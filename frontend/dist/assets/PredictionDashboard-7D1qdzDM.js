var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,i=(a,t,r)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,n=(e,a)=>{for(var t in a||(a={}))s.call(a,t)&&i(e,t,a[t]);if(r)for(var t of r(a))l.call(a,t)&&i(e,t,a[t]);return e},d=(e,r)=>a(e,t(r)),o=(e,a,t)=>new Promise((r,s)=>{var l=e=>{try{n(t.next(e))}catch(a){s(a)}},i=e=>{try{n(t.throw(e))}catch(a){s(a)}},n=e=>e.done?r(e.value):Promise.resolve(e.value).then(l,i);n((t=t.apply(e,a)).next())});import{u as c,k as m,r as u,j as x,L as h,Q as b,a4 as g}from"./react-vendor-CJ3VGwWI.js";import{u as p,a as v,b as j}from"./index-ZW20BDBo.js";import{s as _,t as y,X as f,Y as N,v as w,R as k,w as C,T as P}from"./generateCategoricalChart-DyE8mSr-.js";import"./vendor-wFsWlTaG.js";import"./framer-motion-C2hfdD_N.js";var O=_({chartName:"LineChart",GraphicalChild:y,axisComponents:[{axisType:"xAxis",AxisComp:f},{axisType:"yAxis",AxisComp:N}],formatAxisMap:w});function A(){var e;const{t:a}=c(),t=m(),{isAuthenticated:r,isLoading:s}=p(),{isDark:l}=v(),[i,_]=u.useState(null),[w,A]=u.useState(!1),[L,S]=u.useState(null),[I,D]=u.useState("checking"),[E,T]=u.useState({latitude:12.9716,longitude:77.5946,roof_area_m2:100,tank_capacity_liters:5e3,current_tank_level_liters:2e3,forecast_days:7});if(u.useEffect(()=>{s||r||t("/auth?mode=login")},[r,s,t]),u.useEffect(()=>{let e=!0;const a=()=>o(this,null,function*(){try{const{data:a}=yield j.get("/rain-prediction/health"),t="healthy"===(null==a?void 0:a.status)?"healthy":"unhealthy",r="available"!==(null==a?void 0:a.weather_service)||"available"!==(null==a?void 0:a.prediction_service)?" (degraded)":"";e&&D(t+r)}catch(a){e&&D("unavailable")}});a();const t=setInterval(a,6e4);return()=>{e=!1,clearInterval(t)}},[]),s)return x.jsx("div",{className:"min-h-screen flex items-center justify-center "+(l?"bg-slate-900":"bg-gradient-to-br from-slate-50 via-blue-50 to-cyan-50"),children:x.jsxs("div",{className:"text-center",children:[x.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),x.jsx("p",{className:"text-lg font-medium "+(l?"text-slate-300":"text-slate-600"),children:"Checking authentication..."})]})});if(!r)return null;const B=e=>{const{name:a,value:t}=e.target;T(e=>d(n({},e),{[a]:""===t?"":Number(t)}))},F=()=>{navigator.geolocation.getCurrentPosition(e=>{T(a=>d(n({},a),{latitude:e.coords.latitude,longitude:e.coords.longitude}))})},G=()=>o(this,null,function*(){var e,t;A(!0),S(null);try{const e=yield j.post("/rain-prediction/predict",E);_(e.data)}catch(r){S((null==(t=null==(e=r.response)?void 0:e.data)?void 0:t.detail)||r.message||a("predict.error_generate"))}finally{A(!1)}});a("voice_commands.set_latitude"),a("voice_commands.set_longitude"),a("voice_commands.set_roof_area"),a("voice_commands.set_tank_capacity"),a("voice_commands.generate_prediction"),a("voice_commands.use_gps"),a("voice_commands.go_home");const K=e=>{switch(e){case"urgent":return"bg-red-100 border-red-300 text-red-800";case"high":return"bg-orange-100 border-orange-300 text-orange-800";case"medium":return"bg-yellow-100 border-yellow-300 text-yellow-800";case"low":return"bg-blue-100 border-blue-300 text-blue-800";default:return"bg-gray-100 border-gray-300 text-gray-800"}},M=e=>{switch(e){case"filter_clean":case"maintenance_reminder":return"ðŸ”§";case"tank_overflow":return"âš ï¸";case"recharge_opportunity":return"ðŸ’§";default:return"ðŸ“¢"}};return x.jsx("div",{className:"min-h-screen pt-24 pb-10 "+(l?"bg-slate-900":"bg-gradient-to-br from-slate-50 via-white to-blue-50"),children:x.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[x.jsxs("header",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-6",children:[x.jsxs("div",{children:[x.jsx("h1",{className:"text-3xl font-bold "+(l?"text-slate-100":"text-slate-900"),children:"AI Rainwater Harvest Prediction"}),x.jsxs("p",{className:"text-sm "+(l?"text-slate-400":"text-slate-600"),children:[a("predict.service_status"),": ",I]})]}),x.jsx("div",{className:"flex items-center gap-4",children:x.jsx(h,{to:"/dashboard",className:"text-blue-600 hover:underline",children:a("predict.back_to_dashboard")})})]}),x.jsxs("div",{className:"bg-white rounded-2xl border shadow-lg p-6 mb-6",children:[x.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:a("predict.config_title")}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:a("gda.latitude")}),x.jsx("input",{type:"number",name:"latitude",value:E.latitude,onChange:B,className:"w-full rounded-lg border p-2","aria-label":a("aria.gda_latitude")})]}),x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:a("gda.longitude")}),x.jsx("input",{type:"number",name:"longitude",value:E.longitude,onChange:B,className:"w-full rounded-lg border p-2","aria-label":a("aria.gda_longitude")})]}),x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:a("gda.roof_area")}),x.jsx("input",{type:"number",name:"roof_area_m2",value:E.roof_area_m2,onChange:B,className:"w-full rounded-lg border p-2","aria-label":a("aria.gda_roof_area")})]}),x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:a("gda.tank_capacity")}),x.jsx("input",{type:"number",name:"tank_capacity_liters",value:E.tank_capacity_liters,onChange:B,className:"w-full rounded-lg border p-2","aria-label":a("aria.gda_tank_capacity")})]}),x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:a("gda.current_tank_level")}),x.jsx("input",{type:"number",name:"current_tank_level_liters",value:E.current_tank_level_liters,onChange:B,className:"w-full rounded-lg border p-2","aria-label":a("aria.gda_current_tank")})]}),x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:a("gda.forecast_days")}),x.jsx("input",{type:"number",name:"forecast_days",value:E.forecast_days,onChange:B,min:"1",max:"7",className:"w-full rounded-lg border p-2"})]}),x.jsxs("div",{className:"flex items-end gap-3 col-span-1 md:col-span-2 lg:col-span-3",children:[x.jsxs("button",{onClick:F,className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl border transition-all duration-200 shadow-sm "+(l?"bg-slate-800/60 hover:bg-slate-700/60 text-slate-100 border-slate-600":"bg-white hover:bg-slate-50 text-black border-slate-300"),children:[x.jsx(b,{className:"w-4 h-4"}),x.jsx("span",{children:"Use My Location"})]}),x.jsxs("button",{onClick:G,disabled:w,className:`inline-flex items-center justify-center gap-2 px-5 py-2.5 rounded-xl transition-all duration-200 shadow-md ${w?"opacity-80 cursor-not-allowed":"hover:shadow-lg hover:-translate-y-0.5"} bg-blue-600 hover:bg-blue-700 text-white`,children:[x.jsx(g,{className:"w-4 h-4"}),x.jsx("span",{children:w?a("predict.generating"):"Generate Prediction"})]})]})]})]}),L&&x.jsx("div",{className:"bg-red-100 border border-red-300 text-red-800 p-3 rounded-lg mb-6",children:L}),w&&x.jsx("div",{className:"bg-blue-100 border border-blue-300 text-blue-800 p-3 rounded-lg mb-6",children:a("predict.loading_message")}),i&&x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{className:"bg-white rounded-2xl border shadow-lg p-6",children:[x.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:a("predict.results_title")}),x.jsxs("p",{children:[a("predict.predicted_harvest"),": ",i.harvest_calculations.predicted_harvest_liters.toFixed(0),"L"]})]}),x.jsxs("div",{className:"bg-white rounded-2xl border shadow-lg p-6",children:[x.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:a("predict.chart_title")}),x.jsx("div",{className:"h-80",children:x.jsx(k,{width:"100%",height:"100%",children:x.jsxs(O,{data:(null==(e=i.rain_predictions[0])?void 0:e.time_series)||[],children:[x.jsx(C,{strokeDasharray:"3 3"}),x.jsx(f,{dataKey:"hour",label:{value:a("predict.chart_xaxis"),position:"insideBottom",offset:-10}}),x.jsx(N,{label:{value:a("predict.chart_yaxis"),angle:-90,position:"insideLeft"}}),x.jsx(P,{}),x.jsx(y,{type:"monotone",dataKey:"predicted_rainfall_mm",stroke:"#3B82F6"})]})})})]}),i.action_alerts.length>0&&x.jsxs("div",{className:"bg-white rounded-2xl border shadow-lg p-6",children:[x.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:a("predict.alerts_title")}),x.jsx("div",{className:"space-y-3",children:i.action_alerts.map((e,a)=>x.jsx("div",{className:`p-4 rounded-lg border-l-4 ${K(e.priority)}`,children:x.jsxs("div",{className:"flex items-start gap-3",children:[x.jsx("span",{className:"text-2xl mt-1",children:M(e.alert_type)}),x.jsxs("div",{children:[x.jsx("div",{className:"font-semibold",children:e.title}),x.jsx("p",{children:e.message})]})]})},a))})]})]})]})})}export{A as PredictionDashboard,A as default};
