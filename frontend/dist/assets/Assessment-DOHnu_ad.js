var e=Object.defineProperty,a=Object.defineProperties,s=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,o=(a,s,t)=>s in a?e(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t;import{u as n,e as i,r as d,j as m,L as c}from"./react-vendor-BIG0dXTf.js";import{a as u}from"./api-CUAgWf1P.js";import{u as x,a as p,L as h}from"./index-DdHcYEUd.js";import{u as g,V as b}from"./VoiceAssistantUI-DgXj8NA7.js";import{m as _}from"./framer-motion-CjfoqxEY.js";import"./vendor-B0m_Fmqf.js";function v(){const{t:e}=n(),v=i(),{isAuthenticated:j,isLoading:f}=x(),{isDark:y}=p(),[w,N]=d.useState({user_name:"",location_desc:"",latitude:"",longitude:"",num_dwellers:4,rooftop_area_m2:"",open_space_area_m2:""}),[k,C]=d.useState(!1),[L,O]=d.useState({estimated_collection_m3:0,per_capita_m3:0});if(d.useEffect(()=>{f||j||v("/auth?mode=login")},[j,f,v]),f)return m.jsx("div",{className:"min-h-screen flex items-center justify-center "+(y?"bg-slate-900":"bg-gradient-to-br from-slate-50 via-blue-50 to-cyan-50"),children:m.jsxs("div",{className:"text-center",children:[m.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),m.jsx("p",{className:"text-lg font-medium "+(y?"text-slate-300":"text-slate-600"),children:"Checking authentication..."})]})});if(!j)return null;const F=(e,n)=>{const i=e.includes("area")||e.includes("num")||e.includes("lat")||e.includes("lon")?""===n?"":Number(n):n,d=(m=((e,a)=>{for(var s in a||(a={}))r.call(a,s)&&o(e,s,a[s]);if(t)for(var s of t(a))l.call(a,s)&&o(e,s,a[s]);return e})({},w),a(m,s({[e]:i})));var m;N(d),P(d)},P=e=>{const a=(Number(e.rooftop_area_m2)||0)+(Number(e.open_space_area_m2)||0),s=Math.max(0,.7*a)/100,t=e.num_dwellers?s/Number(e.num_dwellers):0;O({estimated_collection_m3:Number(s.toFixed(2)),per_capita_m3:Number(t.toFixed(2))})},I=()=>{navigator.geolocation.getCurrentPosition(e=>{F("latitude",e.coords.latitude),F("longitude",e.coords.longitude)})},z=()=>{return e=this,a=null,s=function*(){C(!0);try{const{data:e}=yield u.post("/assessments",w);v(`/results/${e.id}`)}finally{C(!1)}},new Promise((t,r)=>{var l=e=>{try{n(s.next(e))}catch(a){r(a)}},o=e=>{try{n(s.throw(e))}catch(a){r(a)}},n=e=>e.done?t(e.value):Promise.resolve(e.value).then(l,o);n((s=s.apply(e,a)).next())});var e,a,s},B={[e("voice_commands.set_name")]:e=>F("user_name",e),[e("voice_commands.set_location")]:e=>F("location_desc",e),[e("voice_commands.use_gps")]:I,[e("voice_commands.set_dwellers")]:e=>F("num_dwellers",parseInt(e,10)),[e("voice_commands.set_rooftop_area")]:e=>F("rooftop_area_m2",parseInt(e,10)),[e("voice_commands.set_open_space_area")]:e=>F("open_space_area_m2",parseInt(e,10)),[e("voice_commands.submit_form")]:z,[e("voice_commands.go_home")]:()=>v("/")},{isListening:M,setIsListening:S,feedback:V}=g(B);return m.jsxs(_.div,{initial:{opacity:0},animate:{opacity:1},className:"min-h-screen pt-24 pb-10 "+(y?"bg-slate-900":"bg-gradient-to-br from-slate-50 via-white to-blue-50"),children:[m.jsxs("div",{className:"w-full max-w-2xl mx-auto px-4",children:[m.jsxs("header",{className:"flex justify-between items-center mb-6",children:[m.jsxs(c,{to:"/dashboard",className:"text-blue-600 hover:text-blue-800 font-medium flex items-center gap-2 transition-colors",children:[m.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),e("common.back_to_dashboard")]}),m.jsx(h,{})]}),m.jsx("div",{className:"relative rounded-2xl border border-gray-200 bg-white shadow-xl",children:m.jsxs("div",{className:"p-8 space-y-6",children:[m.jsxs("div",{className:"text-center",children:[m.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent mb-2",children:e("assessment.title")}),m.jsx("p",{className:"text-gray-600",children:e("assessment.subtitle")})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[m.jsxs("div",{className:"md:col-span-2",children:[m.jsx("label",{htmlFor:"user_name",className:"block text-sm font-medium text-gray-700",children:e("user_name")}),m.jsx("input",{id:"user_name",name:"user_name",value:w.user_name,onChange:e=>F(e.target.name,e.target.value),placeholder:e("assessment.name_placeholder"),className:"mt-1 w-full rounded-lg border-gray-300 shadow-sm","aria-label":e("aria.user_name")})]}),m.jsxs("div",{className:"md:col-span-2",children:[m.jsx("label",{htmlFor:"location_desc",className:"block text-sm font-medium text-gray-700",children:e("location")}),m.jsxs("div",{className:"flex gap-2 mt-1",children:[m.jsx("input",{id:"location_desc",name:"location_desc",value:w.location_desc,onChange:e=>F(e.target.name,e.target.value),placeholder:e("assessment.location_placeholder"),className:"flex-1 w-full rounded-lg border-gray-300 shadow-sm","aria-label":e("aria.location_desc")}),m.jsx("button",{type:"button",onClick:I,className:"px-4 py-2 rounded-lg border border-gray-300 bg-white hover:bg-gray-50 text-sm font-medium","aria-label":e("aria.use_gps"),children:e("assessment.gps_button")})]})]}),m.jsxs("div",{children:[m.jsx("label",{htmlFor:"latitude",className:"block text-sm font-medium text-gray-700",children:e("assessment.latitude")}),m.jsx("input",{id:"latitude",name:"latitude",type:"number",value:w.latitude,onChange:e=>F(e.target.name,e.target.value),placeholder:"e.g. 12.9716",className:"mt-1 w-full rounded-lg border-gray-300 shadow-sm","aria-label":e("aria.latitude")})]}),m.jsxs("div",{children:[m.jsx("label",{htmlFor:"longitude",className:"block text-sm font-medium text-gray-700",children:e("assessment.longitude")}),m.jsx("input",{id:"longitude",name:"longitude",type:"number",value:w.longitude,onChange:e=>F(e.target.name,e.target.value),placeholder:"e.g. 77.5946",className:"mt-1 w-full rounded-lg border-gray-300 shadow-sm","aria-label":e("aria.longitude")})]}),m.jsxs("div",{children:[m.jsx("label",{htmlFor:"num_dwellers",className:"block text-sm font-medium text-gray-700",children:e("dwellers")}),m.jsx("input",{id:"num_dwellers",name:"num_dwellers",type:"number",value:w.num_dwellers,onChange:e=>F(e.target.name,e.target.value),placeholder:"e.g. 4",className:"mt-1 w-full rounded-lg border-gray-300 shadow-sm","aria-label":e("aria.num_dwellers")})]}),m.jsxs("div",{children:[m.jsx("label",{htmlFor:"rooftop_area_m2",className:"block text-sm font-medium text-gray-700",children:e("rooftop_area")}),m.jsx("input",{id:"rooftop_area_m2",name:"rooftop_area_m2",type:"number",value:w.rooftop_area_m2,onChange:e=>F(e.target.name,e.target.value),placeholder:"m²",className:"mt-1 w-full rounded-lg border-gray-300 shadow-sm","aria-label":e("aria.rooftop_area")})]}),m.jsxs("div",{className:"md:col-span-2",children:[m.jsx("label",{htmlFor:"open_space_area_m2",className:"block text-sm font-medium text-gray-700",children:e("open_space_area")}),m.jsx("input",{id:"open_space_area_m2",name:"open_space_area_m2",type:"number",value:w.open_space_area_m2,onChange:e=>F(e.target.name,e.target.value),placeholder:"m²",className:"mt-1 w-full rounded-lg border-gray-300 shadow-sm","aria-label":e("aria.open_space_area")})]})]}),m.jsxs("div",{className:"mt-6 p-6 rounded-xl border bg-gradient-to-r from-blue-50 to-cyan-50 border-blue-200",children:[m.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[m.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),e("assessment.live_preview")]}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{className:"p-4 text-center rounded-lg bg-white border border-blue-200 shadow-sm",children:[m.jsx("div",{className:"text-sm font-medium text-blue-600 mb-1",children:e("assessment.estimated_collection")}),m.jsxs("div",{className:"text-2xl font-bold text-gray-800",children:[L.estimated_collection_m3," m³"]}),m.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Annual rainwater collection"})]}),m.jsxs("div",{className:"p-4 text-center rounded-lg bg-white border border-cyan-200 shadow-sm",children:[m.jsx("div",{className:"text-sm font-medium text-cyan-600 mb-1",children:e("assessment.per_capita")}),m.jsxs("div",{className:"text-2xl font-bold text-gray-800",children:[L.per_capita_m3," m³"]}),m.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Per person per year"})]})]})]}),m.jsxs("div",{className:"flex justify-between items-center pt-6 border-t border-gray-200",children:[m.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[m.jsx("svg",{className:"w-4 h-4 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e("assessment.form_validation")]}),m.jsxs("div",{className:"flex gap-3",children:[m.jsx("button",{onClick:()=>{const e={user:w.user_name,location:w.location_desc,coordinates:`${w.latitude}, ${w.longitude}`,estimatedCollection:L.estimated_collection_m3,perCapita:L.per_capita_m3,timestamp:(new Date).toLocaleString()},a=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),s=URL.createObjectURL(a),t=document.createElement("a");t.href=s,t.download=`rainwater_assessment_preview_${Date.now()}.json`,t.click(),URL.revokeObjectURL(s)},className:"px-4 py-2 rounded-lg border border-blue-300 text-blue-600 hover:bg-blue-50 font-medium transition-colors",children:e("assessment.generate_preview")}),m.jsx("button",{disabled:k,onClick:z,className:"px-6 py-3 rounded-lg text-white font-semibold shadow-md transition-all "+(k?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 hover:shadow-lg"),"aria-label":e("aria.submit_assessment"),children:k?m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsxs("svg",{className:"animate-spin w-4 h-4",fill:"none",viewBox:"0 0 24 24",children:[m.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),m.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e("assessment.submitting")]}):m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),e("submit")]})})]})]})]})})]}),m.jsx(b,{isListening:M,setIsListening:S,feedback:V})]})}export{v as Assessment,v as default};
