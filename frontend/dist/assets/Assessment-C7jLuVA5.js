var e=Object.defineProperty,a=Object.defineProperties,r=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,l=(a,r,t)=>r in a?e(a,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[r]=t,n=(e,a)=>{for(var r in a||(a={}))s.call(a,r)&&l(e,r,a[r]);if(t)for(var r of t(a))o.call(a,r)&&l(e,r,a[r]);return e},i=(e,t)=>a(e,r(t)),d=(e,a,r)=>new Promise((t,s)=>{var o=e=>{try{n(r.next(e))}catch(a){s(a)}},l=e=>{try{n(r.throw(e))}catch(a){s(a)}},n=e=>e.done?t(e.value):Promise.resolve(e.value).then(o,l);n((r=r.apply(e,a)).next())});import{u as c,k as m,r as u,j as b,L as p}from"./react-vendor-CJ3VGwWI.js";import{u as x,a as _,b as h}from"./index-ZW20BDBo.js";import{m as g}from"./framer-motion-C2hfdD_N.js";import"./vendor-wFsWlTaG.js";function f(){const{t:e}=c(),a=m(),{isAuthenticated:r,isLoading:t}=x(),{isDark:s}=_(),[o,l]=u.useState({user_name:"",location_desc:"",latitude:"",longitude:"",num_dwellers:"",rooftop_area_m2:"",open_space_area_m2:""}),[f,N]=u.useState(!1),[v,j]=u.useState(!1),[y,w]=u.useState({estimated_collection_m3:0,per_capita_m3:0}),[k,L]=u.useState({});if(u.useEffect(()=>{t||r||a("/auth?mode=login")},[r,t,a]),t)return b.jsx("div",{className:"min-h-screen flex items-center justify-center "+(s?"bg-slate-900":"bg-gradient-to-br from-slate-50 via-blue-50 to-cyan-50"),children:b.jsxs("div",{className:"text-center",children:[b.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),b.jsx("p",{className:"text-lg font-medium "+(s?"text-slate-300":"text-slate-600"),children:"Checking authentication..."})]})});if(!r)return null;const C=(e,a)=>{const r=e.includes("area")||e.includes("num")||e.includes("lat")||e.includes("lon")?""===a?"":Number(a):a,t=i(n({},o),{[e]:r});l(t),q(t);const s=((e,a)=>{let r="";switch(e){case"user_name":a&&""!==a.trim()||(r="Name is required");break;case"location_desc":a&&""!==a.trim()||(r="Location is required");break;case"latitude":a&&""!==a?isNaN(Number(a))?r="Latitude must be a valid number":(Number(a)<-90||Number(a)>90)&&(r="Latitude must be between -90 and 90 degrees"):r="Latitude is required";break;case"longitude":a&&""!==a?isNaN(Number(a))?r="Longitude must be a valid number":(Number(a)<-180||Number(a)>180)&&(r="Longitude must be between -180 and 180 degrees"):r="Longitude is required";break;case"num_dwellers":a&&""!==a&&0!==a?isNaN(Number(a))?r="Number of dwellers must be a valid number":Number(a)<1?r="Number of dwellers must be at least 1":Number(a)>100&&(r="Number of dwellers cannot exceed 100"):r="Number of dwellers is required";break;case"rooftop_area_m2":a&&""!==a&&0!==a?isNaN(Number(a))?r="Rooftop area must be a valid number":Number(a)<0?r="Rooftop area cannot be negative":Number(a)>1e4&&(r="Rooftop area cannot exceed 10,000 m¬≤"):r="Rooftop area is required";break;case"open_space_area_m2":a&&""!==a&&0!==a?isNaN(Number(a))?r="Open space area must be a valid number":Number(a)<0?r="Open space area cannot be negative":Number(a)>5e4&&(r="Open space area cannot exceed 50,000 m¬≤"):r="Open space area is required"}return r})(e,r);L(a=>i(n({},a),{[e]:s}))},q=e=>{const a=(Number(e.rooftop_area_m2)||0)+(Number(e.open_space_area_m2)||0),r=Math.max(0,.7*a)/100,t=e.num_dwellers?r/Number(e.num_dwellers):0;w({estimated_collection_m3:Number(r.toFixed(2)),per_capita_m3:Number(t.toFixed(2))})},O=(e,a)=>d(this,null,function*(){try{const r=yield fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${e}&longitude=${a}&localityLanguage=en`);if(!r.ok)throw new Error("Geocoding failed");const t=yield r.json(),s=t.city||t.locality||t.principalSubdivision,o=t.countryCode;return s&&o?`${s}, ${o}`:"Current Location"}catch(r){return"Current Location"}}),F=()=>d(this,null,function*(){if(!navigator.geolocation)return;j(!0);const e=document.querySelector('[aria-label*="location"]');e&&(e.disabled=!0,e.textContent="üìç Getting...");try{const e=yield new Promise((e,a)=>{navigator.geolocation.getCurrentPosition(e,a,{enableHighAccuracy:!0,timeout:15e3,maximumAge:3e4})}),r=Number(e.coords.latitude.toFixed(6)),t=Number(e.coords.longitude.toFixed(6));let s=`Location (${r}, ${t})`;try{s=yield O(r,t)}catch(a){}l(e=>i(n({},e),{latitude:r,longitude:t,location_desc:s}))}catch(a){l(e=>i(n({},e),{latitude:"",longitude:"",location_desc:"Location not available"}))}finally{j(!1),e&&(e.disabled=!1,e.textContent="üìç Get Location")}}),P=()=>d(this,null,function*(){var e,r;N(!0);try{const e=(()=>{const e=[];return o.user_name&&""!==o.user_name.trim()||e.push("Name is required"),o.location_desc&&""!==o.location_desc.trim()||e.push("Location is required"),o.latitude&&""!==o.latitude?isNaN(Number(o.latitude))?e.push("Latitude must be a valid number"):(Number(o.latitude)<-90||Number(o.latitude)>90)&&e.push("Latitude must be between -90 and 90 degrees"):e.push("Latitude is required"),o.longitude&&""!==o.longitude?isNaN(Number(o.longitude))?e.push("Longitude must be a valid number"):(Number(o.longitude)<-180||Number(o.longitude)>180)&&e.push("Longitude must be between -180 and 180 degrees"):e.push("Longitude is required"),o.num_dwellers&&""!==o.num_dwellers&&0!==o.num_dwellers?isNaN(Number(o.num_dwellers))?e.push("Number of dwellers must be a valid number"):Number(o.num_dwellers)<1?e.push("Number of dwellers must be at least 1"):Number(o.num_dwellers)>100&&e.push("Number of dwellers cannot exceed 100"):e.push("Number of dwellers is required"),o.rooftop_area_m2&&""!==o.rooftop_area_m2&&0!==o.rooftop_area_m2?isNaN(Number(o.rooftop_area_m2))?e.push("Rooftop area must be a valid number"):Number(o.rooftop_area_m2)<0?e.push("Rooftop area cannot be negative"):Number(o.rooftop_area_m2)>1e4&&e.push("Rooftop area cannot exceed 10,000 m¬≤"):e.push("Rooftop area is required"),o.open_space_area_m2&&""!==o.open_space_area_m2&&0!==o.open_space_area_m2?isNaN(Number(o.open_space_area_m2))?e.push("Open space area must be a valid number"):Number(o.open_space_area_m2)<0?e.push("Open space area cannot be negative"):Number(o.open_space_area_m2)>5e4&&e.push("Open space area cannot exceed 50,000 m¬≤"):e.push("Open space area is required"),e})();if(e.length>0)return alert("Please fill in all required fields:\n\n"+e.join("\n")),void N(!1);const r={user_name:o.user_name.trim(),location_desc:o.location_desc.trim(),latitude:Number(o.latitude),longitude:Number(o.longitude),num_dwellers:Number(o.num_dwellers),rooftop_area_m2:Number(o.rooftop_area_m2),open_space_area_m2:Number(o.open_space_area_m2)},{data:t}=yield h.post("/assessments",r);a(`/results/${t.id}`)}catch(t){alert(`Failed to create assessment: ${(null==(r=null==(e=t.response)?void 0:e.data)?void 0:r.detail)||t.message}`)}finally{N(!1)}});return e("voice_commands.set_name"),e("voice_commands.set_location"),e("voice_commands.use_gps"),e("voice_commands.set_dwellers"),e("voice_commands.set_rooftop_area"),e("voice_commands.set_open_space_area"),e("voice_commands.submit_form"),e("voice_commands.go_home"),b.jsx(g.div,{initial:{opacity:0},animate:{opacity:1},className:"min-h-screen pt-24 pb-10 "+(s?"bg-slate-900":"bg-gradient-to-br from-slate-50 via-white to-blue-50"),children:b.jsxs("div",{className:"w-full max-w-2xl mx-auto px-4",children:[b.jsx("header",{className:"flex justify-start items-center mb-8",children:b.jsxs(p,{to:"/dashboard",className:"text-gray-600 hover:text-gray-800 font-medium flex items-center gap-2 transition-colors",children:[b.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back"]})}),b.jsxs("div",{className:"relative rounded-3xl border border-gray-200 bg-white shadow-2xl overflow-hidden",children:[b.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-cyan-600 p-6 text-white",children:b.jsxs("div",{className:"text-center",children:[b.jsx("h1",{className:"text-3xl font-bold mb-2",children:e("assessment.title")}),b.jsx("p",{className:"text-blue-100",children:e("assessment.subtitle")})]})}),b.jsxs("div",{className:"p-8 space-y-6",children:[b.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[b.jsxs("div",{className:"md:col-span-2",children:[b.jsxs("label",{htmlFor:"user_name",className:"block text-sm font-semibold text-gray-700 mb-2",children:[e("user_name")," ",b.jsx("span",{className:"text-red-500",children:"*"})]}),b.jsx("input",{id:"user_name",name:"user_name",value:o.user_name,onChange:e=>C(e.target.name,e.target.value),placeholder:e("assessment.name_placeholder"),className:"w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500/20 "+(k.user_name?"border-red-300 focus:border-red-500":"border-gray-200 focus:border-blue-500"),"aria-label":e("aria.user_name"),required:!0}),k.user_name&&b.jsx("p",{className:"mt-1 text-sm text-red-600",children:k.user_name})]}),b.jsxs("div",{className:"md:col-span-2",children:[b.jsxs("label",{htmlFor:"location_desc",className:"block text-sm font-semibold text-gray-700 mb-2",children:[e("location")," ",b.jsx("span",{className:"text-red-500",children:"*"})]}),b.jsxs("div",{className:"flex gap-3",children:[b.jsx("input",{id:"location_desc",name:"location_desc",value:o.location_desc,onChange:e=>C(e.target.name,e.target.value),placeholder:e("assessment.location_placeholder"),className:"flex-1 w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500/20 "+(k.location_desc?"border-red-300 focus:border-red-500":"border-gray-200 focus:border-blue-500"),"aria-label":e("aria.location_desc"),disabled:v,required:!0}),b.jsx("button",{type:"button",onClick:F,className:"px-6 py-3 rounded-xl border-2 border-gray-200 bg-white hover:bg-gray-50 hover:border-blue-300 text-sm font-semibold transition-all duration-200 flex items-center gap-2","aria-label":e("aria.use_gps"),children:"üìç Get Location"})]}),k.location_desc&&b.jsx("p",{className:"mt-1 text-sm text-red-600",children:k.location_desc})]}),b.jsxs("div",{children:[b.jsxs("label",{htmlFor:"latitude",className:"block text-sm font-semibold text-gray-700 mb-2",children:[e("assessment.latitude")," ",b.jsx("span",{className:"text-red-500",children:"*"})]}),b.jsx("input",{id:"latitude",name:"latitude",type:"number",step:"any",value:o.latitude,onChange:e=>C(e.target.name,e.target.value),placeholder:"e.g. 12.9716",className:"w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500/20 "+(k.latitude?"border-red-300 focus:border-red-500":"border-gray-200 focus:border-blue-500"),"aria-label":e("aria.latitude"),disabled:v,required:!0}),k.latitude&&b.jsx("p",{className:"mt-1 text-sm text-red-600",children:k.latitude})]}),b.jsxs("div",{children:[b.jsxs("label",{htmlFor:"longitude",className:"block text-sm font-semibold text-gray-700 mb-2",children:[e("assessment.longitude")," ",b.jsx("span",{className:"text-red-500",children:"*"})]}),b.jsx("input",{id:"longitude",name:"longitude",type:"number",step:"any",value:o.longitude,onChange:e=>C(e.target.name,e.target.value),placeholder:"e.g. 77.5946",className:"w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500/20 "+(k.longitude?"border-red-300 focus:border-red-500":"border-gray-200 focus:border-blue-500"),"aria-label":e("aria.longitude"),disabled:v,required:!0}),k.longitude&&b.jsx("p",{className:"mt-1 text-sm text-red-600",children:k.longitude})]}),b.jsxs("div",{children:[b.jsxs("label",{htmlFor:"num_dwellers",className:"block text-sm font-semibold text-gray-700 mb-2",children:[e("dwellers")," ",b.jsx("span",{className:"text-red-500",children:"*"})]}),b.jsx("input",{id:"num_dwellers",name:"num_dwellers",type:"number",min:"1",max:"100",value:o.num_dwellers,onChange:e=>C(e.target.name,e.target.value),placeholder:"e.g. 4",className:"w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500/20 "+(k.num_dwellers?"border-red-300 focus:border-red-500":"border-gray-200 focus:border-blue-500"),"aria-label":e("aria.num_dwellers"),required:!0}),k.num_dwellers&&b.jsx("p",{className:"mt-1 text-sm text-red-600",children:k.num_dwellers})]}),b.jsxs("div",{children:[b.jsxs("label",{htmlFor:"rooftop_area_m2",className:"block text-sm font-semibold text-gray-700 mb-2",children:[e("rooftop_area")," ",b.jsx("span",{className:"text-red-500",children:"*"})]}),b.jsx("input",{id:"rooftop_area_m2",name:"rooftop_area_m2",type:"number",min:"0.1",max:"10000",step:"0.1",value:o.rooftop_area_m2,onChange:e=>C(e.target.name,e.target.value),placeholder:"m¬≤",className:"w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500/20 "+(k.rooftop_area_m2?"border-red-300 focus:border-red-500":"border-gray-200 focus:border-blue-500"),"aria-label":e("aria.rooftop_area"),required:!0}),k.rooftop_area_m2&&b.jsx("p",{className:"mt-1 text-sm text-red-600",children:k.rooftop_area_m2})]}),b.jsxs("div",{className:"md:col-span-2",children:[b.jsxs("label",{htmlFor:"open_space_area_m2",className:"block text-sm font-semibold text-gray-700 mb-2",children:[e("open_space_area")," ",b.jsx("span",{className:"text-red-500",children:"*"})]}),b.jsx("input",{id:"open_space_area_m2",name:"open_space_area_m2",type:"number",min:"0.1",max:"50000",step:"0.1",value:o.open_space_area_m2,onChange:e=>C(e.target.name,e.target.value),placeholder:"m¬≤",className:"w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500/20 "+(k.open_space_area_m2?"border-red-300 focus:border-red-500":"border-gray-200 focus:border-blue-500"),"aria-label":e("aria.open_space_area"),required:!0}),k.open_space_area_m2&&b.jsx("p",{className:"mt-1 text-sm text-red-600",children:k.open_space_area_m2})]})]}),b.jsxs("div",{className:"mt-6 p-6 rounded-xl border bg-gradient-to-r from-blue-50 to-cyan-50 border-blue-200",children:[b.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[b.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),e("assessment.live_preview")]}),b.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[b.jsxs("div",{className:"p-4 text-center rounded-lg bg-white border border-blue-200 shadow-sm",children:[b.jsx("div",{className:"text-sm font-medium text-blue-600 mb-1",children:e("assessment.estimated_collection")}),b.jsxs("div",{className:"text-2xl font-bold text-gray-800",children:[y.estimated_collection_m3," m¬≥"]}),b.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Annual rainwater collection"})]}),b.jsxs("div",{className:"p-4 text-center rounded-lg bg-white border border-cyan-200 shadow-sm",children:[b.jsx("div",{className:"text-sm font-medium text-cyan-600 mb-1",children:"Per Capita Collection"}),b.jsx("div",{className:"text-2xl font-bold text-gray-800",children:y.per_capita_m3.toFixed(1)}),b.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Cubic meters per person"})]})]})]}),b.jsx("div",{className:"flex justify-center pt-8",children:b.jsx("button",{disabled:f||v,onClick:P,className:"px-8 py-4 rounded-xl text-white font-semibold shadow-lg transition-all transform hover:scale-105 "+(f||v?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 hover:shadow-xl"),"aria-label":e("aria.submit_assessment"),children:f?b.jsxs("div",{className:"flex items-center gap-3",children:[b.jsxs("svg",{className:"animate-spin w-5 h-5",fill:"none",viewBox:"0 0 24 24",children:[b.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),b.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Creating Assessment..."]}):v?b.jsxs("div",{className:"flex items-center gap-3",children:[b.jsxs("svg",{className:"animate-spin w-5 h-5",fill:"none",viewBox:"0 0 24 24",children:[b.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),b.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Getting Location..."]}):b.jsxs("div",{className:"flex items-center gap-3",children:[b.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"Submit"]})})})]})]})]})})}export{f as Assessment,f as default};
