var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,i=(t,s,r)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r,l=(e,t)=>{for(var s in t||(t={}))a.call(t,s)&&i(e,s,t[s]);if(r)for(var s of r(t))n.call(t,s)&&i(e,s,t[s]);return e},o=(e,r)=>t(e,s(r));import{u as c,e as d,r as m,j as u,L as h}from"./react-vendor-BIG0dXTf.js";import{u as f,a as x,L as g}from"./index-DdHcYEUd.js";import{u as p,V as b}from"./VoiceAssistantUI-DgXj8NA7.js";import"./vendor-B0m_Fmqf.js";import"./framer-motion-CjfoqxEY.js";function v(){const{t:e}=c(),t=d(),{isAuthenticated:s,isLoading:r}=f(),{isDark:a}=x(),[n,i]=m.useState([]),[v,y]=m.useState(""),[j,w]=m.useState(!1),[N,S]=m.useState(!1),_=m.useRef(null),k=m.useRef(!0),O=m.useRef({}),D=m.useRef(null),E=m.useRef(!1),P=m.useRef(!1);if(m.useEffect(()=>{if(k.current)k.current=!1;else if(E.current)E.current=!1;else if(!P.current&&!j&&D.current){const e=D.current,t=O.current[e];return t&&t.scrollIntoView({behavior:"smooth",block:"center"}),void(D.current=null)}},[n,j]),m.useEffect(()=>{},[j]),m.useEffect(()=>{window.scrollTo({top:0,left:0,behavior:"auto"})},[]),m.useEffect(()=>{r||s||t("/auth?mode=login")},[s,r,t]),m.useEffect(()=>{const e=sessionStorage.getItem("predefinedMessage");e&&(sessionStorage.removeItem("predefinedMessage"),setTimeout(()=>{P.current=!0,L(e),window.scrollTo({top:0,left:0,behavior:"smooth"})},100))},[]),r)return u.jsx("div",{className:"min-h-screen flex items-center justify-center "+(a?"bg-slate-900":"bg-gradient-to-br from-slate-50 via-blue-50 to-cyan-50"),children:u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),u.jsx("p",{className:"text-lg font-medium "+(a?"text-slate-300":"text-slate-600"),children:"Checking authentication..."})]})});if(!s)return null;const L=(t,s)=>{return r=this,a=null,n=function*(){var s;const r=(t||v).trim();if(!r||N)return;const a={id:Date.now().toString(),content:r,isUser:!0,timestamp:new Date};i(e=>[...e,a]),y(""),S(!0);const n=(Date.now()+1).toString();i(e=>[...e,{id:n,content:"",isUser:!1,timestamp:new Date,isStreaming:!0}]);try{const t=yield fetch("http://localhost:8000/api/chat/stream",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:a.content})});if(!t.ok)throw new Error(e("chat.error_response"));const r=null==(s=t.body)?void 0:s.getReader(),d=new TextDecoder;if(r){let e="";for(;;){const{done:t,value:s}=yield r.read();if(t)break;P.current=!0;const a=d.decode(s).split("\n");for(const r of a)if(r.startsWith("data: "))try{const t=JSON.parse(r.slice(6));t.chunk&&"[DONE]"!==t.chunk&&(e+=t.chunk,i(t=>t.map(t=>t.id===n?o(l({},t),{content:e}):t)))}catch(c){}}}i(e=>e.map(e=>e.id===n?o(l({},e),{isStreaming:!1}):e)),P.current=!1}catch(d){i(t=>t.map(t=>t.id===n?o(l({},t),{content:e("chat.error_message"),isStreaming:!1}):t))}finally{S(!1)}},new Promise((e,t)=>{var s=e=>{try{l(n.next(e))}catch(s){t(s)}},i=e=>{try{l(n.throw(e))}catch(s){t(s)}},l=t=>t.done?e(t.value):Promise.resolve(t.value).then(s,i);l((n=n.apply(r,a)).next())});var r,a,n},I=()=>i([]),R={[e("voice_commands.send_message")]:e=>{y(e),L(e)},[e("voice_commands.clear_chat")]:I,[e("voice_commands.go_home")]:()=>t("/")},{isListening:T,setIsListening:U,feedback:C}=p(R);return u.jsxs("div",{className:`min-h-screen pt-24 pb-10 ${a?"bg-slate-900":"bg-gray-50"} flex flex-col items-center px-4`,children:[u.jsxs("header",{className:"w-full max-w-4xl flex justify-between items-center mb-4",children:[u.jsx(h,{to:"/",className:"text-blue-600 hover:underline",children:e("chat.back_to_home")}),u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx(g,{}),u.jsx("button",{onClick:I,className:"px-3 py-2 text-sm text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg hover:bg-gray-100","aria-label":e("aria.clear_chat"),children:e("chat.clear_chat")})]})]}),u.jsx("main",{className:"w-full max-w-4xl",role:"main",children:u.jsxs("div",{className:"relative rounded-2xl border border-gray-200 bg-white shadow-lg overflow-hidden",children:[u.jsxs("div",{className:"h-96 overflow-y-auto p-6 space-y-4","aria-live":"polite",children:[0===n.length?u.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"text-4xl mb-4",children:"ðŸ¤–"}),u.jsx("p",{className:"text-lg",children:e("chat.welcome_title")}),u.jsx("p",{className:"text-sm mt-2",children:e("chat.welcome_subtitle")})]})}):n.map(e=>u.jsx("div",{ref:t=>{O.current[e.id]=t},className:"flex "+(e.isUser?"justify-end":"justify-start"),children:u.jsxs("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-2xl "+(e.isUser?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"),children:[u.jsxs("p",{className:"text-sm",children:[e.content,e.isStreaming&&u.jsx("span",{className:"inline-block w-2 h-4 bg-current animate-pulse ml-1"})]}),u.jsx("time",{className:"text-xs mt-1 "+(e.isUser?"text-blue-100":"text-gray-500"),children:e.timestamp.toLocaleTimeString()})]})},e.id)),u.jsx("div",{ref:_})]}),u.jsx("div",{className:"border-t border-gray-200 p-4",children:u.jsxs("div",{className:"flex gap-3",children:[u.jsx("input",{type:"text",value:v,onChange:e=>{y(e.target.value),w(!0)},onBlur:()=>w(!1),onKeyPress:e=>"Enter"===e.key&&!e.shiftKey&&(e.preventDefault(),w(!1),L()),placeholder:e("chat.input_placeholder"),disabled:N,className:"flex-1 rounded-lg border-gray-300 px-4 py-2 focus:ring-2 focus:ring-blue-500","aria-label":e("aria.chat_input")}),u.jsx("button",{onClick:()=>L(),disabled:!v.trim()||N,className:"px-6 py-2 rounded-lg text-white font-semibold shadow "+(!v.trim()||N?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"),"aria-label":e("aria.send_message"),children:e(N?"chat.sending":"chat.send")})]})})]})}),u.jsx(b,{isListening:T,setIsListening:U,feedback:C})]})}export{v as Chat,v as default};
