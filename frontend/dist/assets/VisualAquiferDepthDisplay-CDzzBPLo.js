import{u as e,e as t,r as a,j as s,L as n,a7 as l,a8 as o,ac as i,ad as r}from"./react-vendor-BIG0dXTf.js";/* empty css                */import{L as d}from"./index-DdHcYEUd.js";import{u as c,V as m}from"./VoiceAssistantUI-DgXj8NA7.js";import{m as u}from"./framer-motion-CjfoqxEY.js";import"./vendor-B0m_Fmqf.js";const x=(e,t)=>{return a=void 0,s=null,n=function*(){const a=`/api/gamification/groundwater?lat=${e}&lon=${t}`;let s=yield fetch(a);if(404!==s.status&&405!==s.status||(s=yield fetch(`/groundwater?lat=${e}&lon=${t}`)),!s.ok)throw new Error("Failed to fetch groundwater data");const n=yield s.json();return{location:{name:n.location,lat:e,lon:t},timestamp:n.last_updated,data_source:"RTRWH Backend",aquifers:[{id:`${e},${t}`,name:n.location,depth_from:0,depth_to:80,water_table:n.groundwater_level_m,color:"#60a5fa",aquifer_type:n.aquifer_type,borewells_connected:n.borewells_connected}]}},new Promise((e,t)=>{var l=e=>{try{i(n.next(e))}catch(a){t(a)}},o=e=>{try{i(n.throw(e))}catch(a){t(a)}},i=t=>t.done?e(t.value):Promise.resolve(t.value).then(l,o);i((n=n.apply(a,s)).next())});var a,s,n};function h({onPick:e}){return r({click:t=>e(t.latlng.lat,t.latlng.lng)}),null}function p({onPick:t,lat:a,lon:n}){const{t:r}=e();return s.jsxs(l,{center:[a,n],zoom:5,style:{height:300,width:"100%",borderRadius:16},className:"z-10",children:[s.jsx(o,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:r("gda.map_attribution")}),s.jsx(i,{position:[a,n]}),s.jsx(h,{onPick:t})]})}function j(){const{t:l}=e(),o=t(),[i,r]=a.useState(null),[h,j]=a.useState(22.5),[f,g]=a.useState(77),[b,v]=a.useState(null),[_,w]=a.useState(null);a.useEffect(()=>{w(null),r(null),x(h,f).then(r).catch(e=>w(e.message||l("vad.error_fetch")))},[h,f,l]);const y=a.useMemo(()=>(null==i?void 0:i.aquifers)||[],[i]);a.useMemo(()=>Math.max(...y.map(e=>e.depth_to),1),[y]);const N=()=>{if(!i)return;const e=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download=`aquifer_data_${i.location.name.replace(/\s+/g,"_")}.json`,a.click(),URL.revokeObjectURL(t)},k={[l("voice_commands.set_latitude")]:e=>j(parseFloat(e)),[l("voice_commands.set_longitude")]:e=>g(parseFloat(e)),[l("voice_commands.download_data")]:N,[l("voice_commands.go_home")]:()=>o("/")},{isListening:L,setIsListening:R,feedback:S}=c(k);return s.jsxs(u.div,{className:"mx-auto my-8 p-6 rounded-3xl shadow-2xl border bg-white/80 backdrop-blur-lg","aria-label":l("aria.vad_main"),initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[s.jsxs("header",{className:"mb-4 flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-3xl font-bold text-gray-800",children:l("vad.title")}),s.jsx("p",{className:"text-gray-600 mt-1",children:l("vad.subtitle")})]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(n,{to:"/dashboard",className:"text-blue-600 hover:underline",children:l("gda.back_to_dashboard")}),s.jsx(d,{})]})]}),s.jsx("div",{className:"mb-6",children:s.jsx(p,{onPick:(e,t)=>{j(Number(e.toFixed(5))),g(Number(t.toFixed(5)))},lat:h,lon:f})}),s.jsxs("div",{className:"flex flex-col md:flex-row gap-8 items-center",children:[s.jsx("div",{className:"flex-1 min-w-[220px]",children:_?s.jsx("div",{children:_}):i?s.jsx("div",{}):s.jsx("div",{children:l("vad.loading")})}),s.jsx("aside",{className:"flex-1 w-full max-w-[350px] bg-gray-50 rounded-2xl p-4 shadow-inner border",children:i&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-700",children:l("vad.location_title")}),s.jsx("p",{children:i.location.name}),s.jsxs("p",{className:"text-sm text-gray-500",children:["(",i.location.lat,", ",i.location.lon,")"]})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("h3",{className:"font-semibold text-gray-700",children:l("vad.source_title")}),s.jsx("p",{children:i.data_source}),s.jsxs("p",{className:"text-sm text-gray-500",children:[l("vad.last_updated"),": ",new Date(i.timestamp).toLocaleString()]})]}),s.jsx("button",{onClick:N,className:"btn btn-sm btn-outline mt-6","aria-label":l("aria.download_data"),children:l("vad.download_button")})]})})]}),s.jsx(m,{isListening:L,setIsListening:R,feedback:S})]})}export{j as default};
