var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,i=(a,t,s)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s,n=(e,a)=>{for(var t in a||(a={}))r.call(a,t)&&i(e,t,a[t]);if(s)for(var t of s(a))l.call(a,t)&&i(e,t,a[t]);return e},d=(e,s)=>a(e,t(s));import{u as o,e as c,r as m,j as u,L as x}from"./react-vendor-BIG0dXTf.js";import{a as b}from"./api-CUAgWf1P.js";import{u as g,a as p,L as h}from"./index-DdHcYEUd.js";import{u as _,V as j}from"./VoiceAssistantUI-DgXj8NA7.js";import{R as v,L as f,C as y,X as N,Y as w,T as k,b as C}from"./LineChart-CdOcRGC2.js";import"./vendor-B0m_Fmqf.js";import"./framer-motion-CjfoqxEY.js";function L(){var e;const{t:a}=o(),t=c(),{isAuthenticated:s,isLoading:r}=g(),{isDark:l}=p(),[i,L]=m.useState(null),[O,P]=m.useState(!1),[F,S]=m.useState(null),[I,D]=m.useState("checking"),[A,B]=m.useState({latitude:12.9716,longitude:77.5946,roof_area_m2:100,tank_capacity_liters:5e3,current_tank_level_liters:2e3,forecast_days:7});if(m.useEffect(()=>{r||s||t("/auth?mode=login")},[s,r,t]),r)return u.jsx("div",{className:"min-h-screen flex items-center justify-center "+(l?"bg-slate-900":"bg-gradient-to-br from-slate-50 via-blue-50 to-cyan-50"),children:u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),u.jsx("p",{className:"text-lg font-medium "+(l?"text-slate-300":"text-slate-600"),children:"Checking authentication..."})]})});if(!s)return null;const E=e=>{const{name:a,value:t}=e.target;B(e=>d(n({},e),{[a]:""===t?"":Number(t)}))},K=()=>{navigator.geolocation.getCurrentPosition(e=>{B(a=>d(n({},a),{latitude:e.coords.latitude,longitude:e.coords.longitude}))})},V=()=>{return e=this,t=null,s=function*(){var e,t;P(!0),S(null);try{const e=yield b.post("/rain-prediction/predict",A);L(e.data)}catch(s){S((null==(t=null==(e=s.response)?void 0:e.data)?void 0:t.detail)||s.message||a("predict.error_generate"))}finally{P(!1)}},new Promise((a,r)=>{var l=e=>{try{n(s.next(e))}catch(a){r(a)}},i=e=>{try{n(s.throw(e))}catch(a){r(a)}},n=e=>e.done?a(e.value):Promise.resolve(e.value).then(l,i);n((s=s.apply(e,t)).next())});var e,t,s},R={[a("voice_commands.set_latitude")]:e=>B(a=>d(n({},a),{latitude:parseFloat(e)})),[a("voice_commands.set_longitude")]:e=>B(a=>d(n({},a),{longitude:parseFloat(e)})),[a("voice_commands.set_roof_area")]:e=>B(a=>d(n({},a),{roof_area_m2:parseFloat(e)})),[a("voice_commands.set_tank_capacity")]:e=>B(a=>d(n({},a),{tank_capacity_liters:parseFloat(e)})),[a("voice_commands.generate_prediction")]:V,[a("voice_commands.use_gps")]:K,[a("voice_commands.go_home")]:()=>t("/")},{isListening:T,setIsListening:U,feedback:X}=_(R),Y=e=>{switch(e){case"urgent":return"bg-red-100 border-red-300 text-red-800";case"high":return"bg-orange-100 border-orange-300 text-orange-800";case"medium":return"bg-yellow-100 border-yellow-300 text-yellow-800";case"low":return"bg-blue-100 border-blue-300 text-blue-800";default:return"bg-gray-100 border-gray-300 text-gray-800"}},$=e=>{switch(e){case"filter_clean":case"maintenance_reminder":return"🔧";case"tank_overflow":return"⚠️";case"recharge_opportunity":return"💧";default:return"📢"}};return u.jsxs("div",{className:"min-h-screen pt-24 pb-10 "+(l?"bg-slate-900":"bg-gradient-to-br from-slate-50 via-white to-blue-50"),children:[u.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[u.jsxs("header",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-6",children:[u.jsxs("div",{children:[u.jsx("h1",{className:"text-3xl font-bold "+(l?"text-slate-100":"text-slate-900"),children:a("predict.title")}),u.jsxs("p",{className:"text-sm "+(l?"text-slate-400":"text-slate-600"),children:[a("predict.service_status"),": ",I]})]}),u.jsxs("div",{className:"flex items-center gap-4",children:[u.jsx(x,{to:"/dashboard",className:"text-blue-600 hover:underline",children:a("predict.back_to_dashboard")}),u.jsx(h,{})]})]}),u.jsxs("div",{className:"bg-white rounded-2xl border shadow-lg p-6 mb-6",children:[u.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:a("predict.config_title")}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:a("gda.latitude")}),u.jsx("input",{type:"number",name:"latitude",value:A.latitude,onChange:E,className:"w-full rounded-lg border p-2","aria-label":a("aria.gda_latitude")})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:a("gda.longitude")}),u.jsx("input",{type:"number",name:"longitude",value:A.longitude,onChange:E,className:"w-full rounded-lg border p-2","aria-label":a("aria.gda_longitude")})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:a("gda.roof_area")}),u.jsx("input",{type:"number",name:"roof_area_m2",value:A.roof_area_m2,onChange:E,className:"w-full rounded-lg border p-2","aria-label":a("aria.gda_roof_area")})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:a("gda.tank_capacity")}),u.jsx("input",{type:"number",name:"tank_capacity_liters",value:A.tank_capacity_liters,onChange:E,className:"w-full rounded-lg border p-2","aria-label":a("aria.gda_tank_capacity")})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:a("gda.current_tank_level")}),u.jsx("input",{type:"number",name:"current_tank_level_liters",value:A.current_tank_level_liters,onChange:E,className:"w-full rounded-lg border p-2","aria-label":a("aria.gda_current_tank")})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:a("gda.forecast_days")}),u.jsx("input",{type:"number",name:"forecast_days",value:A.forecast_days,onChange:E,min:"1",max:"7",className:"w-full rounded-lg border p-2"})]}),u.jsxs("div",{className:"flex items-end gap-2",children:[u.jsx("button",{onClick:K,className:"btn btn-outline",children:a("gda.use_gps_button")}),u.jsx("button",{onClick:V,disabled:O,className:"btn btn-primary w-full",children:a(O?"predict.generating":"predict.generate_button")})]})]})]}),F&&u.jsx("div",{className:"bg-red-100 border border-red-300 text-red-800 p-3 rounded-lg mb-6",children:F}),O&&u.jsx("div",{className:"bg-blue-100 border border-blue-300 text-blue-800 p-3 rounded-lg mb-6",children:a("predict.loading_message")}),i&&u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{className:"bg-white rounded-2xl border shadow-lg p-6",children:[u.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:a("predict.results_title")}),u.jsxs("p",{children:[a("predict.predicted_harvest"),": ",i.harvest_calculations.predicted_harvest_liters.toFixed(0),"L"]})]}),u.jsxs("div",{className:"bg-white rounded-2xl border shadow-lg p-6",children:[u.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:a("predict.chart_title")}),u.jsx("div",{className:"h-80",children:u.jsx(v,{width:"100%",height:"100%",children:u.jsxs(f,{data:(null==(e=i.rain_predictions[0])?void 0:e.time_series)||[],children:[u.jsx(y,{strokeDasharray:"3 3"}),u.jsx(N,{dataKey:"hour",label:{value:a("predict.chart_xaxis"),position:"insideBottom",offset:-10}}),u.jsx(w,{label:{value:a("predict.chart_yaxis"),angle:-90,position:"insideLeft"}}),u.jsx(k,{}),u.jsx(C,{type:"monotone",dataKey:"predicted_rainfall_mm",stroke:"#3B82F6"})]})})})]}),i.action_alerts.length>0&&u.jsxs("div",{className:"bg-white rounded-2xl border shadow-lg p-6",children:[u.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:a("predict.alerts_title")}),u.jsx("div",{className:"space-y-3",children:i.action_alerts.map((e,a)=>u.jsx("div",{className:`p-4 rounded-lg border-l-4 ${Y(e.priority)}`,children:u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx("span",{className:"text-2xl mt-1",children:$(e.alert_type)}),u.jsxs("div",{children:[u.jsx("div",{className:"font-semibold",children:e.title}),u.jsx("p",{children:e.message})]})]})},a))})]})]})]}),u.jsx(j,{isListening:T,setIsListening:U,feedback:X})]})}export{L as PredictionDashboard,L as default};
